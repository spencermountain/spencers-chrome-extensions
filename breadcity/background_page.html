
<script src="./lib/jquery.js" type="text/javascript"></script> 
<script src="./lib/encode.js" type="text/javascript"></script> 
<script>


$(document).ready(function(){
  
  
   var refreshId = setInterval(function(){
     console.log('ya ');
   }, 10000);//60000ms equals 1 minute

  
  
  chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {

//add this wikipedia page to the home page
     if (request.method == "addwikipedia" && request.url.match('wikipedia.org/wiki/') && !request.url.match(/wikipedia\.org\/wiki\/(Category|special|user):/i)){
             var old = localStorage["learn"] || '[]';
            
            try{ old=JSON.parse(old);
                }catch(e){old=[];}      
              //detect existing
              for(var i in old){
                if(old[i].url==request.url){
                  console.log('already'+request.url)
                  return sendResponse({}); // snub them.
                }                      
              }
      
                 var url="http://keep.spencermountain.user.dev.freebaseapps.com/uri_recon?callback=?&url="+request.url;
                 console.log(request.url)
                 $.getJSON(url, function(obj) { 
                      var old = localStorage["learn"] || '[]';
                      old=JSON.parse(old);                    
                      console.log(old)
                      old.unshift(obj);
                      localStorage["learn"] = JSON.stringify(old);	
                      console.log('this')
                      console.log(obj)
                      return sendResponse({page: obj.name});                   
                 });      
      }
      else{sendResponse({}); // snub them.
      }
      
      
  });

});
</script>
